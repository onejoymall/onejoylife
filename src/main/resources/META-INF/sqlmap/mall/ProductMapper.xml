<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="mall.ProductMapper">
    <select id="getProductTodayList" parameterType="com.webapp.mall.vo.TodayVO" resultType="java.util.Map">
        <![CDATA[
            SELECT
                *,
                (select code.code_name from code where code.code='product_delivery_type' and code.code_value =product.product_delivery_type) as product_delivery_type_name,
                (select Z.product_made_company_name from product_made_company Z where Z.product_made_company_cd=product.product_made_company_cd) as product_made_company_name,
                (select code.code_name from code where code.code='product_sale_yn' and code.code_value =product.product_sale_yn) as product_sale_yn_name,
                (select product_file.file_link from product_file where product_file.key_id = product.product_cd and product_file.file_order = 1) as file_1
            FROM product  where 1=1
        ]]>
        <if test="product_cd_array != null">
            and product_cd IN (
            <foreach item="item" index="index" collection="product_cd_array" separator=",">
                #{item}
            </foreach>
            )
        </if>
        <if test="product_sale_yn != null"> <![CDATA[AND product_sale_yn= #{product_sale_yn} ]]></if>
        <if test="product_use_yn != null"> <![CDATA[AND product_use_yn= #{product_use_yn} ]]></if>
    </select>
    <select id="getProductList" parameterType="com.webapp.board.common.SearchVO" resultType="java.util.Map">
        <![CDATA[
            SELECT
                *,
                (select code.code_name from code where code.code='product_delivery_type' and code.code_value =product.product_delivery_type) as product_delivery_type_name,
                (select Z.product_made_company_name from product_made_company Z where Z.product_made_company_cd=product.product_made_company_cd) as product_made_company_name,
                (select code.code_name from code where code.code='product_sale_yn' and code.code_value =product.product_sale_yn) as product_sale_yn_name,
                (select product_file.file_link from product_file where product_file.key_id = product.product_cd and product_file.file_order = 1) as file_1,
                (select product_file.file_link from product_file where product_file.key_id = product.product_cd and product_file.file_order = 2) as file_2,
                (select product_file.file_link from product_file where product_file.key_id = product.product_cd and product_file.file_order = 3) as file_3,
                (select product_file.file_link from product_file where product_file.key_id = product.product_cd and product_file.file_order = 4) as file_4,
                (select product_file.file_link from product_file where product_file.key_id = product.product_cd and product_file.file_order = 5) as file_5
            FROM product  where 1=1
        ]]>
        <if test="searchKeyword!=null and searchKeyword!='' and searchType!=''">
            <foreach item="item" index="index" collection="searchTypeArr" separator=" OR " open="AND (" close=")">
                ${item} LIKE CONCAT('%', #{searchKeyword},'%' )
            </foreach>
        </if>
        <if test="product_name != null"> <![CDATA[AND product_name LIKE CONCAT('%', #{product_name},'%' ) ]]></if>
        <if test="product_sale_yn != null"> <![CDATA[AND product_sale_yn= #{product_sale_yn} ]]></if>
        <if test="product_use_yn != null"> <![CDATA[AND product_use_yn= #{product_use_yn} ]]></if>
        <if test="product_ct != null"> <![CDATA[AND find_in_set(#{product_ct},replace(product_ct,'|',',')) > 0 ]]></if>
        <if test="mainViewType != null"> <![CDATA[AND find_in_set('Y',replace(${mainViewType},'|',',')) > 0 ]]></if>
        <if test="orderByKey != null"> order by ${orderByKey} ${orderByValue}</if>
        <if test="orderByKey == null"> order by product_id DESC </if>
        LIMIT ${rowStart-1}, ${displayRowCount}
    </select>
    <select id="getProductListCount" parameterType="com.webapp.board.common.SearchVO" resultType="Integer">
        <![CDATA[
        SELECT
            count(*) as cnt
        FROM product  where 1=1
        ]]>
        <if test="searchKeyword!=null and searchKeyword!='' and searchType!=''">
            <foreach item="item" index="index" collection="searchTypeArr" separator=" OR " open="AND (" close=")">
                ${item} LIKE CONCAT('%', #{searchKeyword},'%' )
            </foreach>
        </if>
        <if test="product_name != null"> <![CDATA[AND product_name LIKE CONCAT('%', #{product_name},'%' ) ]]></if>
        <if test="product_sale_yn != null"> <![CDATA[AND product_sale_yn= #{product_sale_yn} ]]></if>
        <if test="product_use_yn != null"> <![CDATA[AND product_use_yn= #{product_use_yn} ]]></if>
        <if test="product_ct != null"> <![CDATA[AND find_in_set(#{product_ct},replace(product_ct,'|',',')) > 0 ]]></if>
        <if test="mainViewType != null"> <![CDATA[AND find_in_set('Y',replace(${mainViewType},'|',',')) > 0 ]]></if>
    </select>
    <select id="getProductViewDetail" parameterType="java.util.Map" resultType="java.util.Map">
        select
         *,
            (select IFNULL(product_point_rate,0)) as product_point_rate,
            (select code.code_name from code where code.code='product_brand' and code.code_value =product.product_brand) as product_brand_name,
            (select code.code_name from code where code.code='product_delivery_type' and code.code_value =product.product_delivery_type) as product_delivery_type_name,
            (select Z.product_made_company_name from product_made_company Z where Z.product_made_company_cd=product.product_made_company_cd) as product_made_company_name,
            (select code.code_name from code where code.code='product_sale_yn' and code.code_value =product.product_sale_yn) as product_sale_yn_name,
            (select product_file.file_link from product_file where product_file.key_id = product.product_cd and product_file.file_order = 1) as file_1,
            (select product_file.file_link from product_file where product_file.key_id = product.product_cd and product_file.file_order = 2) as file_2,
            (select product_file.file_link from product_file where product_file.key_id = product.product_cd and product_file.file_order = 3) as file_3,
            (select product_file.file_link from product_file where product_file.key_id = product.product_cd and product_file.file_order = 4) as file_4,
            (select product_file.file_link from product_file where product_file.key_id = product.product_cd and product_file.file_order = 5) as file_5
        from product where product_cd=#{product_cd}
    </select>
    <select id="getUserProductPaymentList" resultType="java.util.HashMap">
        <![CDATA[
        SELECT
            A.*,
            (select Z.product_cd from product Z where Z.product_id=A.product_id) as product_cd,
            (select Z.product_name from product Z where Z.product_id=A.product_id) as product_name
        FROM product_payment_history A  where 1=1
        ]]>

        <if test="pd_payment_user_id != null"> <![CDATA[AND A.coupon_id= #{pd_payment_user_id} ]]></if>
        <if test="start_date != null"><![CDATA[AND A.reg_date >= #{start_date} ]]></if>
        <if test="end_date != null"><![CDATA[AND A.reg_date < #{end_date} ]]></if>
        <if test="product_cd != null"> <![CDATA[AND product_cd= #{product_cd} ]]></if>
        <if test="pd_payment_amount != null"> <![CDATA[AND product_cd= #{product_cd} ]]></if>
        <if test="product_name != null"> <![CDATA[AND product_name= #{product_name} ]]></if>
        <if test="pd_payment_cd != null"> <![CDATA[AND A.coupon_paid_class_cd= #{pd_payment_cd} ]]></if>
        <if test="pd_payment_class_cd != null"> <![CDATA[AND A.coupon_paid_class_cd= #{pd_payment_class_cd} ]]></if>
    </select>
    <select id="getUserProductPaymentListCount" resultType="java.util.HashMap">
        <![CDATA[
        SELECT
            count(*) as cnt
        FROM product_payment_history A  where 1=1
        ]]>

        <if test="pd_payment_user_id != null"> <![CDATA[AND A.coupon_id= #{pd_payment_user_id} ]]></if>
        <if test="start_date != null"><![CDATA[AND A.reg_date >= #{start_date} ]]></if>
        <if test="end_date != null"><![CDATA[AND A.reg_date < #{end_date} ]]></if>
        <if test="product_cd != null"> <![CDATA[AND product_cd= #{product_cd} ]]></if>
        <if test="pd_payment_amount != null"> <![CDATA[AND product_cd= #{product_cd} ]]></if>
        <if test="product_name != null"> <![CDATA[AND product_name= #{product_name} ]]></if>
        <if test="pd_payment_cd != null"> <![CDATA[AND A.coupon_paid_class_cd= #{pd_payment_cd} ]]></if>
        <if test="pd_payment_class_cd != null"> <![CDATA[AND A.coupon_paid_class_cd= #{pd_payment_class_cd} ]]></if>
    </select>
    <insert id="insertProductFile" parameterType="com.webapp.board.common.FileVO" >
        INSERT INTO product_file (key_id, file_name, real_name, file_size,file_link,file_order)
        VALUES (#{parentPK}, #{filename}, #{realname}, #{filesize},#{filelink},#{fileorder})
    </insert>
    <insert id="insertProduct" parameterType="com.webapp.manager.vo.ProductVO">
       insert into product(
        product_cd,
        product_market_cd,
        product_use_yn,
        product_sale_yn,
        product_ct,
        product_new_class,
        product_md_class,
        product_name,
        product_name_en,
        product_name_mg,
        product_supply_pd_name,
        product_model_name,
        product_summary_memo,
        product_brief_memo,
        product_html,
        product_mobile_html,
        product_mobile_memo_config,
        product_keyword,
        product_tex_class,
        product_user_payment,
        product_company_payment,
        product_payment,
        product_payment_empty_yn,
        product_payment_memo,
        product_order_limit_quantity,
        product_max_limit,
        product_min_limit,
        product_go_event_yn,
        product_adult_yn,
        product_option_yn,
        product_option_class,
        product_option_view_type,
        product_option_set_name,
        product_option_input,
        product_option_style,
        product_option_button_img,
        product_option_color,
        product_option_required,
        product_sold_out_memo,
        product_add_option,
        product_add_option_name,
        product_add_option_required,
        product_add_option_max_lang,
        product_detail_image,
        product_list_image,
        product_list_image_sm,
        product_list_image_response,
        product_add_image,
        product_made_company_cd,
        product_supplier,
        product_brand,
        product_trend,
        product_influencer,
        product_self_class_cd,
        product_create_date,
        product_release_date,
        product_validity_yn,
        product_validity,
        product_origin,
        product_cm,
        product_payment_info,
        product_delivery_info,
        product_change_info,
        product_service_info,
        product_delivery_class,
        product_delivery_type,
        product_delivery_International_type,
        product_delivery_locale,
        product_delivery_payment_type,
        product_delivery_date,
        product_delivery_payment_class,
        product_delivery_payment,
        product_delivery_store_pickup,
        product_kg,
        product_global_hs_code,
        product_global_clearance,
        product_material,
        product_material_en,
        product_fabric,
        product_seo_yn,
        product_seo_title,
        product_seo_author,
        product_seo_description,
        product_seo_keywords,
        product_seo_alt,
        product_payment_type,
        product_delivery_type_code,
        product_memo,
        product_point_class,
        product_point_rate,
        product_point_rate_cash,
        product_sp_class
       )values(
        #{product_cd},
        #{product_market_cd},
        #{product_use_yn},
        #{product_sale_yn},
        #{product_ct},
        #{product_new_class},
        #{product_md_class},
        #{product_name},
        #{product_name_en},
        #{product_name_mg},
        #{product_supply_pd_name},
        #{product_model_name},
        #{product_summary_memo},
        #{product_brief_memo},
        #{product_html},
        #{product_mobile_html},
        #{product_mobile_memo_config},
        #{product_keyword},
        #{product_tex_class},
        #{product_user_payment},
        #{product_company_payment},
        #{product_payment},
        #{product_payment_empty_yn},
        #{product_payment_memo},
        #{product_order_limit_quantity},
        #{product_max_limit},
        #{product_min_limit},
        #{product_go_event_yn},
        #{product_adult_yn},
        #{product_option_yn},
        #{product_option_class},
        #{product_option_view_type},
        #{product_option_set_name},
        #{product_option_input},
        #{product_option_style},
        #{product_option_button_img},
        #{product_option_color},
        #{product_option_required},
        #{product_sold_out_memo},
        #{product_add_option},
        #{product_add_option_name},
        #{product_add_option_required},
        #{product_add_option_max_lang},
        #{product_detail_image},
        #{product_list_image},
        #{product_list_image_sm},
        #{product_list_image_response},
        #{product_add_image},
        #{product_made_company_cd},
        #{product_supplier},
        #{product_brand},
        #{product_trend},
        #{product_influencer},
        #{product_self_class_cd},
        #{product_create_date},
        #{product_release_date},
        #{product_validity_yn},
        #{product_validity},
        #{product_origin},
        #{product_cm},
        #{product_payment_info},
        #{product_delivery_info},
        #{product_change_info},
        #{product_service_info},
        #{product_delivery_class},
        #{product_delivery_type},
        #{product_delivery_International_type},
        #{product_delivery_locale},
        #{product_delivery_payment_type},
        #{product_delivery_date},
        #{product_delivery_payment_class},
        #{product_delivery_payment},
        #{product_delivery_store_pickup},
        #{product_kg},
        #{product_global_hs_code},
        #{product_global_clearance},
        #{product_material},
        #{product_material_en},
        #{product_fabric},
        #{product_seo_yn},
        #{product_seo_title},
        #{product_seo_author},
        #{product_seo_description},
        #{product_seo_keywords},
        #{product_seo_alt},
        #{product_payment_type},
        #{product_delivery_type_code},
        #{product_memo},
        #{product_point_class},
        #{product_point_rate},
        #{product_point_rate_cash},
        #{product_sp_class}
       )

    </insert>
    <insert id="insertProductCopy" parameterType="java.util.Map">
        insert into product (
        product_cd,
        product_market_cd,
        product_use_yn,
        product_sale_yn,
        product_ct,
        product_new_class,
        product_md_class,
        product_name,
        product_name_en,
        product_name_mg,
        product_supply_pd_name,
        product_model_name,
        product_summary_memo,
        product_brief_memo,
        product_html,
        product_mobile_html,
        product_mobile_memo_config,
        product_keyword,
        product_tex_class,
        product_user_payment,
        product_company_payment,
        product_payment,
        product_payment_empty_yn,
        product_payment_memo,
        product_order_limit_quantity,
        product_max_limit,
        product_min_limit,
        product_go_event_yn,
        product_adult_yn,
        product_option_yn,
        product_option_class,
        product_option_view_type,
        product_option_set_name,
        product_option_input,
        product_option_style,
        product_option_button_img,
        product_option_color,
        product_option_required,
        product_sold_out_memo,
        product_add_option,
        product_add_option_name,
        product_add_option_required,
        product_add_option_max_lang,
        product_detail_image,
        product_list_image,
        product_list_image_sm,
        product_list_image_response,
        product_add_image,
        product_made_company_cd,
        product_supplier,
        product_brand,
        product_trend,
        product_influencer,
        product_self_class_cd,
        product_create_date,
        product_release_date,
        product_validity_yn,
        product_validity,
        product_origin,
        product_cm,
        product_payment_info,
        product_delivery_info,
        product_change_info,
        product_service_info,
        product_delivery_class,
        product_delivery_type,
        product_delivery_International_type,
        product_delivery_locale,
        product_delivery_payment_type,
        product_delivery_date,
        product_delivery_payment_class,
        product_delivery_payment,
        product_delivery_store_pickup,
        product_kg,
        product_global_hs_code,
        product_global_clearance,
        product_material,
        product_material_en,
        product_fabric,
        product_seo_yn,
        product_seo_title,
        product_seo_author,
        product_seo_description,
        product_seo_keywords,
        product_seo_alt,
        product_payment_type,
        product_delivery_type_code,
        product_memo,
        product_point_class,
        product_point_rate,
        product_point_rate_cash
        )
        select
        #{product_cd},
        product_market_cd,
        product_use_yn,
        product_sale_yn,
        product_ct,
        product_new_class,
        product_md_class,
        product_name,
        product_name_en,
        product_name_mg,
        product_supply_pd_name,
        product_model_name,
        product_summary_memo,
        product_brief_memo,
        product_html,
        product_mobile_html,
        product_mobile_memo_config,
        product_keyword,
        product_tex_class,
        product_user_payment,
        product_company_payment,
        product_payment,
        product_payment_empty_yn,
        product_payment_memo,
        product_order_limit_quantity,
        product_max_limit,
        product_min_limit,
        product_go_event_yn,
        product_adult_yn,
        product_option_yn,
        product_option_class,
        product_option_view_type,
        product_option_set_name,
        product_option_input,
        product_option_style,
        product_option_button_img,
        product_option_color,
        product_option_required,
        product_sold_out_memo,
        product_add_option,
        product_add_option_name,
        product_add_option_required,
        product_add_option_max_lang,
        product_detail_image,
        product_list_image,
        product_list_image_sm,
        product_list_image_response,
        product_add_image,
        product_made_company_cd,
        product_supplier,
        product_brand,
        product_trend,
        product_influencer,
        product_self_class_cd,
        product_create_date,
        product_release_date,
        product_validity_yn,
        product_validity,
        product_origin,
        product_cm,
        product_payment_info,
        product_delivery_info,
        product_change_info,
        product_service_info,
        product_delivery_class,
        product_delivery_type,
        product_delivery_International_type,
        product_delivery_locale,
        product_delivery_payment_type,
        product_delivery_date,
        product_delivery_payment_class,
        product_delivery_payment,
        product_delivery_store_pickup,
        product_kg,
        product_global_hs_code,
        product_global_clearance,
        product_material,
        product_material_en,
        product_fabric,
        product_seo_yn,
        product_seo_title,
        product_seo_author,
        product_seo_description,
        product_seo_keywords,
        product_seo_alt,
        product_payment_type,
        product_delivery_type_code,
        product_memo,
        product_point_class,
        product_point_rate,
        product_point_rate_cash
         from product where product_cd = #{request_product_cd}

    </insert>
    <insert id="insertProductFileCopy" parameterType="java.util.Map">
        insert into product_file (key_id,file_name,real_name,file_size,file_link,file_order)
        select #{product_cd},file_name,real_name,file_size,file_link,file_order from product_file where key_id =#{request_product_cd}
    </insert>
    <update id="updateProduct" parameterType="com.webapp.manager.vo.ProductVO">
        <![CDATA[
        update product set
        product_market_cd=#{product_market_cd},
        product_use_yn=#{product_use_yn},
        product_sale_yn=#{product_sale_yn},
        product_ct=#{product_ct},
        product_new_class=#{product_new_class},
        product_md_class=#{product_md_class},
        product_name=#{product_name},
        product_name_en=#{product_name_en},
        product_name_mg=#{product_name_mg},
        product_supply_pd_name=#{product_supply_pd_name},
        product_model_name=#{product_model_name},
        product_summary_memo=#{product_summary_memo},
        product_brief_memo=#{product_brief_memo},
        product_html=#{product_html},
        product_mobile_html=#{product_mobile_html},
        product_mobile_memo_config=#{product_mobile_memo_config},
        product_keyword=#{product_keyword},
        product_tex_class=#{product_tex_class},
        product_user_payment=#{product_user_payment},
        product_company_payment=#{product_company_payment},
        product_payment=#{product_payment},
        product_payment_empty_yn=#{product_payment_empty_yn},
        product_payment_memo=#{product_payment_memo},
        product_order_limit_quantity=#{product_order_limit_quantity},
        product_max_limit=#{product_max_limit},
        product_min_limit=#{product_min_limit},
        product_go_event_yn=#{product_go_event_yn},
        product_adult_yn=#{product_adult_yn},
        product_option_yn=#{product_option_yn},
        product_option_class=#{product_option_class},
        product_option_view_type=#{product_option_view_type},
        product_option_set_name=#{product_option_set_name},
        product_option_input=#{product_option_input},
        product_option_style=#{product_option_style},
        product_option_button_img=#{product_option_button_img},
        product_option_color=#{product_option_color},
        product_option_required=#{product_option_required},
        product_sold_out_memo=#{product_sold_out_memo},
        product_add_option=#{product_add_option},
        product_add_option_name=#{product_add_option_name},
        product_add_option_required=#{product_add_option_required},
        product_add_option_max_lang=#{product_add_option_max_lang},
        product_detail_image=#{product_detail_image},
        product_list_image=#{product_list_image},
        product_list_image_sm=#{product_list_image_sm},
        product_list_image_response=#{product_list_image_response},
        product_add_image=#{product_add_image},
        product_made_company_cd=#{product_made_company_cd},
        product_supplier=#{product_supplier},
        product_brand=#{product_brand},
        product_trend=#{product_trend},
        product_influencer=#{product_influencer},
        product_self_class_cd=#{product_self_class_cd},
        product_create_date=#{product_create_date},
        product_release_date=#{product_release_date},
        product_validity_yn=#{product_validity_yn},
        product_validity=#{product_validity},
        product_origin=#{product_origin},
        product_cm=#{product_cm},
        product_payment_info=#{product_payment_info},
        product_delivery_info=#{product_delivery_info},
        product_change_info=#{product_change_info},
        product_service_info=#{product_service_info},
        product_delivery_class=#{ product_delivery_class},
        product_delivery_type=#{ product_delivery_type},
        product_delivery_International_type=#{ product_delivery_International_type},
        product_delivery_locale=#{ product_delivery_locale},
        product_delivery_payment_type=#{ product_delivery_payment_type},
        product_delivery_date=#{ product_delivery_date},
        product_delivery_payment_class=#{ product_delivery_payment_class},
        product_delivery_payment=#{ product_delivery_payment},
        product_delivery_store_pickup=#{ product_delivery_store_pickup},
        product_kg=#{ product_kg},
        product_global_hs_code=#{ product_global_hs_code},
        product_global_clearance=#{ product_global_clearance},
        product_material=#{ product_material},
        product_material_en=#{ product_material_en},
        product_fabric=#{ product_fabric},
        product_seo_yn=#{ product_seo_yn},
        product_seo_title=#{ product_seo_title},
        product_seo_author=#{ product_seo_author},
        product_seo_description=#{ product_seo_description},
        product_seo_keywords=#{ product_seo_keywords},
        product_seo_alt=#{ product_seo_alt},
        product_payment_type=#{ product_payment_type},
        product_delivery_type_code=#{ product_delivery_type_code},
        product_memo=#{ product_memo},
        product_point_class=#{ product_point_class},
        product_point_rate=#{ product_point_rate},
        product_point_rate_cash=#{ product_point_rate_cash},
        product_sp_class = #{product_sp_class}
        where product_cd =#{product_cd}
        ]]>
    </update>
    <delete id="deleteProduct" parameterType="java.util.Map">
        <foreach collection="list" item="item" separator=";" open="DECLARE BEGIN" close="; END;">
        <![CDATA[
        delete product where product_id = #{item.product_id}
        ]]>
        </foreach>
    </delete>
    <delete id="deleteProductPaymentHistory" parameterType="java.util.Map">
        <foreach collection="list" item="item" separator=";" open="DECLARE BEGIN" close="; END;">
            <![CDATA[
        delete product_payment_history where pd_payment_history_id = #{item.pd_payment_history_id}
        ]]>
        </foreach>
    </delete>
    <delete id="deleteProductFile" parameterType="com.webapp.manager.vo.ProductVO">
        delete from product_file where key_id=#{product_cd}
    </delete>
</mapper>
