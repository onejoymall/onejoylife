<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="mall.DeliveryMapper">
    <select id="getDeliveryLatest" resultType="java.util.Map" parameterType="java.util.Map">
        select A.*
        from delivery_info A where order_user_id=#{order_user_id}
        order by reg_date desc
        limit 1
    </select>
    <select id="getDeliveryList"  parameterType="java.util.Map">
        select A.*
        from delivery_info A where product_cd is not null
        <if test="giveaway_cd != null"> <![CDATA[AND A.giveaway_cd= #{giveaway_cd} ]]></if>
        <if test="order_user_id != null"> <![CDATA[AND A.order_user_id= #{order_user_id} ]]></if>
        <if test="product_cd != null"> <![CDATA[AND A.product_cd= #{product_cd} ]]></if>
        <if test="order_no != null"> <![CDATA[AND A.order_no= #{order_no} ]]></if>
        <if test="delivery_status != null"> <![CDATA[AND A.delivery_status= #{delivery_status} ]]></if>
        order by reg_date desc
    </select>
    <select id="getDeliveryListCount" resultType="Integer" parameterType="java.util.Map">
        select count(*)
        from delivery_info A  where product_cd is not null
        <if test="giveaway_cd != null"> <![CDATA[AND A.giveaway_cd= #{giveaway_cd} ]]></if>
        <if test="order_user_id != null"> <![CDATA[AND A.order_user_id= #{order_user_id} ]]></if>
        <if test="product_cd != null"> <![CDATA[AND A.product_cd= #{product_cd} ]]></if>
        <if test="order_no != null"> <![CDATA[AND A.order_no= #{order_no} ]]></if>
        <if test="delivery_status != null"> <![CDATA[AND A.delivery_status= #{delivery_status} ]]></if>

    </select>
    <insert id="insertDelivery" parameterType="com.webapp.mall.vo.DeliveryInfoVO">
        insert into delivery_info(
        giveaway_play_cd,
        order_no,
        product_cd,
        giveaway_cd,
        order_user_id,
        order_user_name,
        order_user_email,
        order_user_phone,
        delivery_type,
        delivery_user_name,
        delivery_user_phone,
        delivery_user_tel,
        postcode,
        roadAddress,
        extraAddress,
        jibunAddress,
        delivery_message
        )values(
        #{giveaway_play_cd},
        #{order_no},
        #{product_cd},
        #{giveaway_cd},
        #{order_user_id},
        #{order_user_name},
        #{order_user_email},
        #{order_user_phone},
        #{delivery_type},
        #{delivery_user_name},
        #{delivery_user_phone},
        #{delivery_user_tel},
        #{postcode},
        #{roadAddress},
        #{extraAddress},
        #{jibunAddress},
        #{delivery_message}
        )
        on duplicate KEY update

        order_no= #{order_no},
        product_cd= #{product_cd},
        giveaway_cd= #{giveaway_cd},
        order_user_id= #{order_user_id},
        order_user_name= #{order_user_name},
        order_user_email= #{order_user_email},
        order_user_phone= #{order_user_phone},
        delivery_type= #{delivery_type},
        delivery_user_name= #{delivery_user_name},
        delivery_user_phone= #{delivery_user_phone},
        delivery_user_tel=#{delivery_user_tel},
        postcode=#{postcode},
        roadAddress=#{roadAddress},
        extraAddress=#{extraAddress},
        jibunAddress=#{jibunAddress},
        delivery_message=#{delivery_message}
    </insert>

    <select id="getDeliveryDetail" resultType="java.util.Map" parameterType="java.util.Map">
        select A.*
        from delivery_info A where 1=1
        <if test="giveaway_cd != null"> <![CDATA[AND A.giveaway_cd= #{giveaway_cd} ]]></if>
        <if test="order_user_id != null"> <![CDATA[AND A.order_user_id= #{order_user_id} ]]></if>
        <if test="product_cd != null"> <![CDATA[AND A.product_cd= #{product_cd} ]]></if>
        <if test="order_no != null"> <![CDATA[AND A.order_no= #{order_no} ]]></if>
    </select>
    <update id="updateDelivery" parameterType="com.webapp.mall.vo.DeliveryInfoVO">
        update delivery_info set
        delivery_status = #{delivery_status}
        where order_no=#{merchant_uid}
    </update>
</mapper>
