<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="mall.UserMapper">
    <select id="getFindUser" resultType="java.util.HashMap">
        <![CDATA[
        SELECT
          A.*
        FROM user A where phone =#{phone}
        ]]>
    </select>
    <select id="getUserList" resultType="java.util.HashMap">
        <![CDATA[
        SELECT
          A.*
        FROM user A where email =#{email}
        ]]>
        <if test="level != null"> <![CDATA[AND A.level= #{level} ]]></if>
        <if test="password != null"> <![CDATA[AND A.password= #{password} ]]></if>
        <if test="phone != null"> <![CDATA[AND A.phone= #{phone} ]]></if>
    </select>
    <insert id="insertUser" parameterType="String">
        <![CDATA[
        insert into user(
        username,email,password,lastname,firstname,email_auth_code,email_auth_status,refferal_code,iso_code,phone,level,group_id)
      VALUES (
        #{username},
        #{email},
        #{password},
        #{lastname},
        #{firstname},
        #{email_auth_code},
        #{email_auth_status},
        #{refferal_code},
        #{iso_code},
        #{phone},
        #{level},
        #{group_id}
        )
        ]]>
    </insert>
    <insert id="insertEmailAuth" parameterType="String">
        <![CDATA[
        insert into email_auth(
        email,email_auth_code)
      VALUES (
        #{email},
        #{email_auth_code}
        )
        on duplicate KEY update
        email_auth_code=#{email_auth_code}
        ]]>
    </insert>
    <select id="getEmailAuthList" resultType="java.util.Map">
        <![CDATA[
        SELECT
          A.*
        FROM email_auth A where 1=1

        ]]>
        <if test="email != null"> <![CDATA[AND A.email= #{email} ]]></if>
        <if test="password_change_code != null"> <![CDATA[AND A.password_change_code= #{password_change_code} ]]></if>
        <![CDATA[ limit 1 ]]>
    </select>
    <update id="updateToken" parameterType="String">
        <![CDATA[
        update user set
        access_token=#{access_token}
        where email = #{email}
        ]]>
    </update>
    <update id="updatePasswordChangeCode" parameterType="String">
        <![CDATA[
        update email_auth set
        password_change_code=#{password_change_code}
        where email = #{email}
        ]]>
    </update>
    <update id="updatePasswordChange" parameterType="String">
        <![CDATA[
        update user set
        password=#{password}
        where email = #{email}
        ]]>
    </update>

    <insert id="insertSnsUser" parameterType="java.util.Map">

        insert into user(
        username,email,password,lastname,firstname,email_auth_code,email_auth_status,refferal_code,iso_code,phone,level,group_id)
      VALUES (
        #{username},
        #{email},
        #{password},
        #{lastname},
        #{firstname},
        #{email_auth_code},
        #{email_auth_status},
        #{refferal_code},
        #{iso_code},
        #{phone},
        #{level},
        #{group_id}
        )
        on duplicate KEY update
        username=#{username}

    </insert>


</mapper>

