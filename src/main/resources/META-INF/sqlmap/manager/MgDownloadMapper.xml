<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="mall.MgDownloadMapper">

  <select id="getProductDtoList" parameterType="com.webapp.manager.vo.ProductVO" resultType="java.util.Map">
    <![CDATA[
            SELECT
                *
            FROM product A  where 1=1
        ]]>
    <if test="searchKeyword!=null and searchKeyword!='' and searchType!=''">
      <foreach item="item" index="index" collection="searchTypeArr" separator=" OR " open="AND (" close=")">
        A.${item} LIKE CONCAT('%', #{searchKeyword},'%' )
      </foreach>
    </if>
    order by product_id desc
    limit 100
  </select>
  <select id="getGiveawayDtoList" parameterType="com.webapp.board.common.SearchVO" resultType="java.util.Map">
    <![CDATA[
            SELECT
                *
            FROM giveaway A  where 1=1
        ]]>
    <if test="searchKeyword!=null and searchKeyword!='' and searchType!=''">
      <foreach item="item" index="index" collection="searchTypeArr" separator=" OR " open="AND (" close=")">
        A.${item} LIKE CONCAT('%', #{searchKeyword},'%' )
      </foreach>
    </if>
    order by reg_date desc
    limit 100
  </select>
  <select id="getOrderDtoList" parameterType="java.util.Map" resultType="java.util.Map">
    <![CDATA[
        SELECT
            A.*,
            (select Z.product_name from product Z where Z.product_cd = A.product_cd) product_name
        FROM payment A
        ]]>
        <if test="payment_status != null and payment_status !=''"><![CDATA[AND A.payment_status = #{payment_status} ]]></if>
        <if test="start_date != null and start_date !=''"><![CDATA[AND A.reg_date >= #{start_date} ]]></if>
        <if test="end_date != null and end_date !=''"><![CDATA[AND A.reg_date <= #{end_date} ]]></if>
        <if test="delivery_start_date != null and delivery_start_date !=''"><![CDATA[AND (select Z.delivery_start_date from delivery_info Z where Z.order_no=A.order_no) >= #{delivery_start_date} ]]></if>
        <if test="delivery_end_date != null and delivery_end_date !=''"><![CDATA[AND (select Z.delivery_start_date from delivery_info Z where Z.order_no=A.order_no) <= #{delivery_end_date} ]]></if>
        <if test="merchant_uid != null"> <![CDATA[AND A.merchant_uid= #{merchant_uid} ]]></if>
        <if test="payment_user_id != null"> <![CDATA[AND A.payment_user_id= #{payment_user_id} ]]></if>
        <if test="order_no != null"> <![CDATA[AND A.order_no= #{order_no} ]]></if>
    order by reg_date desc
    limit 100
  </select>
</mapper>
